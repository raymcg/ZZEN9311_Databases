QUESTION 1

select title from movies where runtime > 300;

QUESTION 2

select genre, count(genre) as nmovies from movie_genres 
group by genre
order by genre;

QUESTION 3

select title, rating, nvotes from movies
where nvotes > 50000
order by rating desc, title asc
limit 10;

QUESTION 4

create view most_regions as
select movie_id as movie, count(distinct region) as nregions from aliases 
group by movie_id
order by nregions desc
limit 1;

select movies.title as movie, most_regions.nregions 
from movies join  most_regions on (movies.id = most_regions.movie);


QUESTION 5

-- create a view of all actors
create or replace view actors as
select principals.* from principals join known_for 
on principals.movie_id = known_for.movie_id and principals.person_id = known_for.person_id
where role = 'actor';

-- only include actors with more than one movie
create or replace view multimovies as
select * from actors where person_id in
(select person_id from actors group by person_id having count(person_id) > 1);

-- add details regarding the movies to the multimovies view
create or replace view moviedetails as
select * from multimovies join movies on multimovies.movie_id = movies.id;

-- calculate the average rating for their movies for each actor
create or replace view av_ratings as
select person_id, avg(rating)::numeric(5,2) as av_rating from moviedetails
group by person_id;

-- add the actor's name, select those with the highest rating and order them alphabetically
select name from av_ratings join people on av_ratings.person_id = people.id
where av_rating = (select max(av_rating) from av_ratings)
order by name;

QUESTION 6

-- eliminate the documentary and biography genres
create or replace view limited_genres as
select * from movie_genres join movies on
movies.id = movie_genres.movie_id
where genre != 'documentary' and genre != 'biography';

-- limit movies to those with at least 3 genres
create or replace view multi_genres as
select * from limited_genres where movie_id in (
    select movie_id from limited_genres 
    group by movie_id having count(movie_id) >= 3)
    order by title, genre
    ;

-- add a column that contains the genres as comma seperated strings
create or replace view genre_list as
select movie_id, string_agg(genre, ',') as genres from multi_genres
group by movie_id;

-- add the movie title to get to the end result
select title, genres from genre_list join movies on movies.id = genre_list.movie_id
order by title;

QUESTION 7


